---
title: 'Blaster Worm Remote Procedure Call (RPC) exploit'
date: '2003-08-11T00:39:58+02:00'
status: publish
permalink: /article/winnt-blaster-rpc-exploit.html
author: Snakefoot
excerpt: 'Description of the Blaster worm and how to protect the operating system from its RPC attacks.'
type: post
id: 534
category:
    - Troubleshoot
    - Troubleshoot
    - Troubleshoot
tag:
    - exploit
    - msblaster
    - remote-procedure-call
    - virus
    - worms
post_format: []
tags:
    - 'msblaster,remote-procedure-call,worms,exploit,virus'
---
##### Exploit details:

 There is a buffer overrun vulnerability in the [RPC service](/article/winnt-services-rpcss.html). By default the RPC service listens on port 135 and by sending a special crafted message to this port, then it is possible to execute malicious commands within the context of the RPC service.  
  
 The following operating systems has this security hole: - Windows 2000 SP1, SP2, SP3, SP4
- Windows XP SP1
- Windows 2003
 
 This means that after having made a clean install of Windows 2000/XP/2003, and one connects to the Internet without a firewall activated, then one is vulnerable to attacks. The [Blaster worm](http://en.wikipedia.org/wiki/Blaster_worm) is the most common attacker.  
  
 More Info [SecurityFocus.com](http://www.securityfocus.com/bid/8205/info "CVE-2003-0352") (Exploit Sample Code)
 
##### Exploit side effects:

 The [RPC service](/article/winnt-services-rpcss.html) is vital for the operation of Windows, so when vulnerable to attacks then it might crash and cause Windows to shutdown. One of the following messages are usually shown when the RPC Service crashes:
> *This system is shutting down. Please save all work in progress and log off. Any unsaved changes will be lost. This shutdown was initiated by NT AUTHORITY\\SYSTEM  
>   
>  Windows must now restart because the Remote Procedure Call (RPC) service terminated unexpectedly.  
>   
>  The computer will be restarted - it has been initiated by the NT authority system because the remote procedure call (RPC service) terminated unexpectedly.  
>   
>  Generic Host Process for Win32 Services has encountered a problem and needs to close. We are sorry for the inconvenience  
>   
>  The program svchost.exe has generated errors and will be closed by Windows. You will have to restart the program*

 The result of the attacks is usually that the system becomes infected with a virus, which take control of the CPU and the Internet bandwidth, and it is then used for attacking other machines on the Internet.  
  
##### Solution to prevent exploit:

1. Consider enabling a firewall to prevent future attacks (Like [Windows XP Firewall](/article/winxp-firewall.html))
2. Download and install the Microsoft patch [MS04-012 Cumulative Update for Microsoft RPC/DCOM (828741)](http://www.microsoft.com/technet/security/bulletin/ms04-012.mspx). 
  - If unable to install the patch in normal mode, then [boot in safemode](http://support.microsoft.com/kb/315222 "A description of the Safe Mode Boot options in Windows XP [Q315222]") and install it.
  - If installing the patch in safemode, then remember to reinstall the patch afterwards in normal mode. More Info [MS KB818460](http://support.microsoft.com/kb/818460 "How to Install Service Packs and Hotfixes When Windows Is Running in Safe Mode [Q818460]")
3. Download the newest virus database for your existing AntiVira Scanner and scan or use [housecall.antivirus.com](http://housecall.antivirus.com/). (If using WinXP remember to [turn off System Restore](http://support.microsoft.com/kb/310405 "How to turn off and turn on System Restore in Windows XP [Q310405]") temporarily) 
  - Microsoft have created their own [Microsoft Windows Malicious Software Removal Tool (MS KB890830)](http://support.microsoft.com/kb/890830) because newly installed systems are easily infected. (Replaces MS KB833330)
  - McAfee have updated their [Stinger](http://vil.nai.com/vil/stinger/) to handle the most common infections caused by this exploit
  - Symantec have created their own [W32.Blaster.Worm Removal Tool](http://securityresponse.symantec.com/avcenter/venc/data/w32.blaster.worm.removal.tool.html)
4. Check [Windows Update](http://v4.windowsupdate.microsoft.com/) to see if there are other critical patches for your system
 
 Note to stop WinXP/Win2k3 from shutting down within 60 secs (Will give time to download and install patch), press the **Start**-button and **Run...** this command:
 > Shutdown -a

 Note another way to stop the shutting down within 60 secs, is to configure the [RPC service](/article/winnt-services-rpcss.html) to restart automatically:
1. Press **Start**-button and select **Run...** this command:
   > services.msc /s
2. Double click the service **Remote Procedure Call (RPC)** (Not the [Locator](/article/winnt-services-rpclocator.html))
3. Select the **Recovery**-tab
4. Set **First Failure**, **Second Failure**, **Subsequent Failure** to **Restart Service**
5. Press Ok
 
 Note it is possible to block the attacks without installing the patch by disabling DCOM for the [RPC service](/article/winnt-services-rpcss.html). This can be useful incase one cannot acquire the security-patch without connecting to the Internet, with the unpatched machine that has no firewall:
1. Press the **Start**-button and **Run...** this command:
   > Dcomcnfg.exe
2. If you are running Windows XP or Windows Server 2003, perform these additional steps: 
  1. Click the Component Services node under Console Root.
  2. Open the Computers folder.
  3. For the local computer, right-click My Computer, and then click Properties.
  4. For a remote computer, right-click Computers folder, point to New, and then click Computer.
  5. Type the computer name.
  6. Right-click the computer name, and then click Properties.
3. Click the **Default Properties** tab.
4. Clear the **Enable Distributed COM on this Computer** check box.
5. Click **Apply** button and exit Dcomcnfg.exe
6. Restart the operating system for the changes to take effect

##### Exploiters:

 More information about the RPC attackers: - [Exploit-DcomRpc](http://vil.nai.com/vil/content/v_100516.htm)
- [Win32.Autorooter](http://www.europe.f-secure.com/v-descs/rpc.shtml) [Backdoor.IRC.Cirebot](http://securityresponse.symantec.com/avcenter/venc/data/backdoor.irc.cirebot.html) [Worm.Win32.Autorooter](http://www.avp.ch/avpve/worms/win32/autorooter.stm)
- Different security firms have identified the blaster (MSBlast.exe): 
  - Symantec: [W32.Blaster.Worm](http://www.sarc.com/avcenter/venc/data/w32.blaster.worm.html)
  - SANS: [RPC DCOM WORM (MSBLASTER)](http://isc.sans.org/diary.html?date=2003-08-11)
  - TrendMicro: [WORM\_MSBLAST.A](http://www.trendmicro.com/vinfo/virusencyclo/default5.asp?VName=WORM_MSBLAST.A)
  - F-Secure [Lovsan](http://www.europe.f-secure.com/v-descs/msblast.shtml)
- New variants of the Blaster: 
  - [Lovsan-B](http://www.f-secure.com/v-descs/lovsanb.shtml) (Root32.exe)
  - [Lovsan-C](http://www.f-secure.com/v-descs/lovsanc.shtml) (penis32.exe)
  - [Lovsan-D](http://www.sophos.com/virusinfo/analyses/w32blasterd.html) (mspatch.exe)
  - [Lovsan-E](http://us.mcafee.com/virusInfo/default.asp?id=description&virus_k=100582) (mslaugh.exe)
- Blaster Killing Worm: [W32/Nachi.worm](http://vil.nai.com/vil/content/v_100559.htm) [W32.Welchia.Worm](http://securityresponse.symantec.com/avcenter/venc/data/w32.welchia.worm.html)
- Gaobot/Polybot/AgoBot/Phatbot 
  - [W32.Gaobot.AFC](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afc.html) (wmiprvsw.exe)
  - [W32.Gaobot.AFJ](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afj.html) (msiwin84.exe)
  - [W32.Gaobot.AFW](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afw.html) (hkey.exe)
  - [W32.Gaobot.AJD](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afw.html) (wauclt.exe)