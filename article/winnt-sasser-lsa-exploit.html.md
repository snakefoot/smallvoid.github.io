---
title: 'Sasser Worm Local Security Authority (LSA) exploit'
date: '2004-05-02T01:38:54+02:00'
status: publish
permalink: /article/winnt-sasser-lsa-exploit.html
author: Snakefoot
excerpt: 'Description of the Sasser worm and how to protect against its SMB attacks.'
type: post
id: 631
category:
    - Troubleshoot
    - Troubleshoot
tag:
    - exploit
    - sasser
    - virus
    - worms
post_format: []
tags:
    - 'sasser,worms,virus,exploit'
---
##### Exploit details:

 There is a buffer overrun vulnerability in the service-wrapper [Lsass.exe](/article/winnt-services-wrapper.html). By default the service-wrapper listens on port 139 and 445, so when sending a special crafted message to one of these ports, then it is possible to execute malicious commands within the context of the service-wrapper.  
  
 The following operating systems has this security hole: - Windows 2000 SP1, SP2, SP3, SP4
- Windows XP SP1
 
 This means that after having made a clean install of Windows 2000/XP, and one connects to the Internet without a firewall activated, then one is vulnerable to attacks. The [Sasser worm](http://en.wikipedia.org/wiki/Sasser_worm) is the most common attacker.  
  
 More Info [SecurityFocus.com](http://www.securityfocus.com/bid/10108 "CVE-2003-0533") (Exploit sample code)
 
##### Exploit side effects:

 The service wrapper [Lsass.exe](/article/winnt-services-wrapper.html) is vital for the operation of Windows, so when vulnerable to attacks then it might crash and cause Windows to shutdown. One of the following messages are usually shown when the Lsass.exe crashes:
> *LSASS has terminated, the system is going to shutdown in 60 seconds...  
>   
>  Faulting application lsass.exe, version 5.1.2600.1106, faulting module unknown, version 0.0.0.0, fault address 0x00000000.  
>   
>  The error: "C:\\Windows\\system32\\lsass.exe terminated unexpectantly with status code - 1073741819"  
>   
>  LSA Shell (Export Version) has encountered a problem and needs to close. We are sorry for any inconvience.  
>   
>  The system is shutting down. Please save all work in progress and log off. Any unsaved changes will be lost. The shutdown was initiated by NT Authority\\SYSTEM.  
>  The system process "C:\\winnt\\system32\\lsass.exe' terminated unexpectedly with status code 128. The system will now shutdown and restart.*

 The result of the attacks is usually that the system becomes infected with a virus, which take control of the CPU and the Internet bandwidth, and it is then used for attacking other machines on the Internet.  
  
##### Solution to prevent exploit:

1. Consider enabling a firewall to prevent future attacks (Like [Windows XP Firewall](/article/winxp-firewall.html))
2. Download and install the Microsoft patch [MS04-011 Security Update for Microsoft Windows (835732)](http://www.microsoft.com/technet/security/bulletin/ms04-011.mspx). 
  - If unable to install the patch in normal mode, then [boot in safemode](http://support.microsoft.com/kb/315222 "A description of the Safe Mode Boot options in Windows XP [Q315222]") and install it.
  - If installing the patch in safemode, then remember to reinstall the patch afterwards in normal mode. More Info [MS KB818460](http://support.microsoft.com/kb/818460 "How to Install Service Packs and Hotfixes When Windows Is Running in Safe Mode [Q818460]")
3. Download the newest virus database for your existing AntiVira Scanner and scan or use [housecall.antivirus.com](http://housecall.antivirus.com/). (If using WinXP remember to [turn off System Restore](http://support.microsoft.com/kb/310405 "How to turn off and turn on System Restore in Windows XP [Q310405]") temporarily) 
  - Microsoft have created their own [Microsoft Windows Malicious Software Removal Tool (MS KB890830)](http://support.microsoft.com/kb/890830 "The Microsoft Windows Malicious Software Removal Tool helps remove specific, prevalent malicious software from computers that are running supported versions of Windows [Q890830]") because newly installed systems are easily infected. (Replaces MS KB841720)
  - McAfee have updated their [Stinger](http://vil.nai.com/vil/stinger/) to handle the most common infections caused by this exploit
4. Check [Windows Update](http://v4.windowsupdate.microsoft.com/) to see if there are other critical patches for your system
 
 Note to stop WinXP/Win2k3 from shutting down within 60 secs (Will give time to download and install patch), press the **Start**-button and **Run...** this command:
 > Shutdown -a

 Note it is possible to block the attacks without installing the patch by doing one of the following:
 - Create an empty readonly file called "dcpromo.log" in %systemroot%\\debug (Ex. C:\\WinNT\\Debug) by executing these two commands (Press Start-Button and Run...)
   > cmd /c type nul &gt; %systemroot%\\debug\\dcpromo.log  
   > attrib +R %systemroot%\\debug\\dcpromo.log
 - [Disable nbt.sys and block port 139 and 445](/article/winnt-smb-netbios.html)

##### Exploiters:

 More information about the LSA attackers:
  - Sasser 
  - [W32.Sasser.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.worm.html) (avserve.exe)
  - [W32.Sasser.B.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.b.worm.html) (avserve2.exe)
  - [W32.Sasser.C.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.c.worm.html) (?????\_up.exe ex. 12345\_up.exe)
  - [W32.Sasser.D.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.d.html) (skynetave.exe)
  - [W32.Sasser.E.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.e.worm.html) (lsasss.exe)
  - [W32.Sasser.F.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.f.worm.html) (napatch.exe)
  - [W32.Sasser.G.Worm](http://www.sarc.com/avcenter/venc/data/w32.sasser.g.worm.html) (lsasss.exe)
- Gaobot/Polybot/AgoBot/Phatbot 
  - [W32.Gaobot.AFC](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afc.html) (wmiprvsw.exe)
  - [W32.Gaobot.AFJ](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afj.html) (msiwin84.exe)
  - [W32.Gaobot.AFW](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afw.html) (hkey.exe)
  - [W32.Gaobot.AJD](http://www.sarc.com/avcenter/venc/data/w32.gaobot.afw.html) (wauclt.exe)
- Korgo 
  - [W32.Korgo.A](http://www.sarc.com/avcenter/venc/data/w32.korgo.a.html) (Random Filename)
  - [W32.Korgo.B](http://www.sarc.com/avcenter/venc/data/w32.korgo.b.html) (Random Filename)
  - [W32.Korgo.C](http://www.sarc.com/avcenter/venc/data/w32.korgo.c.html) (Random Filename)
  - [W32.Korgo.D](http://www.sarc.com/avcenter/venc/data/w32.korgo.d.html) (Random Filename)
  - [W32.Korgo.E](http://www.sarc.com/avcenter/venc/data/w32.korgo.e.html) (Random Filename)
  - [W32.Korgo.F](http://www.sarc.com/avcenter/venc/data/w32.korgo.f.html) (Random Filename)
  - [W32.Korgo.G](http://www.sarc.com/avcenter/venc/data/w32.korgo.g.html) (Random Filename)
  - [W32.Korgo.H](http://www.sarc.com/avcenter/venc/data/w32.korgo.h.html) (Random Filename)
  - [W32.Korgo.I](http://www.sarc.com/avcenter/venc/data/w32.korgo.i.html) (Random Filename)